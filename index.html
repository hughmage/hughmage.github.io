<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora NEM y Simulador PAES</title>
<link rel="icon" href="luci_logo.svg" type="image/svg+xml">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #3498db;
    --primary-dark: #2980b9;
    --secondary: #2ecc71;
    --dark: #2c3e50;
    --light: #ecf0f1;
    --gray: #95a5a6;
    --danger: #e74c3c;
    --warning: #f39c12;
    --success: #27ae60;
    
    /* Variables de Tema Claro (por defecto) */
    --bg: #f5f7fa;
    --text: #2c3e50;
    --card-bg: white;
    --border: #e0e6ed;
    --input-bg: white;
    --header-text: var(--primary);
    --subtitle-text: var(--gray);
    --label-text: var(--dark);
    --puntaje-box-bg: #27ae60;
    --promedio-box-bg: #ecf0f1;
    --corte-box-bg: #2980b9;
    --corte-text-color: white;
    --promedio-text-color: #2c3e50;
    --box-text-color: white;
    --warning-bg: #fffbe6;
    --saved-sim-bg: #e8f4fd;
  }

  body.dark-mode {
    --bg: #1a1a1a;
    --text: #ecf0f1;
    --card-bg: #2c3e50;
    --border: #3d566e;
    --input-bg: #34495e;
    --header-text: #5dade2;
    --subtitle-text: #bdc3c7;
    --label-text: #ecf0f1;
    --light: #2c3e50;
    --puntaje-box-bg: #2ecc71;
    --promedio-box-bg: #34495e;
    --corte-box-bg: #3498db;
    --corte-text-color: white;
    --promedio-text-color: #ecf0f1;
    --box-text-color: white;
    --warning-bg: #4d442a;
    --saved-sim-bg: #34495e;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--bg);
    color: var(--text);
    line-height: 1.6;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  
  .container {
    max-width: 750px;
    margin: 30px auto;
    padding: 25px;
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .theme-toggle-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--light);
    border: 1px solid var(--border);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease;
    z-index: 100;
  }
  .theme-toggle-btn:hover { transform: scale(1.1) rotate(15deg); }
  .theme-toggle-btn svg { stroke: var(--text); transition: stroke 0.3s ease; }
  #theme-icon-sun { display: none; }
  
  header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }
  
  .isologo { max-width: 420px; height: auto; margin: 0 auto 10px; }
  .subtitle { color: var(--subtitle-text); font-weight: 300; font-size: 1rem; }
  .form-group { margin-bottom: 20px; }
  label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--label-text); }
  
  select, input {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background-color: var(--input-bg);
    color: var(--text);
  }
  
  select:focus, input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
  }

  input.valid, select.valid {
    border-color: var(--success);
    background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2327ae60' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 20px;
    padding-right: 40px;
  }

  input.invalid, select.invalid {
    border-color: var(--danger);
    background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23e74c3c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cline x1='12' y1='8' x2='12' y2='12'/%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 20px;
    padding-right: 40px;
  }
  
  .input-group { display: flex; gap: 15px; }
  .input-item { flex: 1; }
  .help-link { font-size: 0.85rem; color: var(--primary); text-decoration: none; display: inline-flex; align-items: center; margin-top: 5px; transition: all 0.2s ease; }
  .help-link:hover { text-decoration: underline; transform: translateX(2px); }
  .help-link svg { margin-right: 5px; }
  
  button {
    width: 100%;
    padding: 14px;
    background-color: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  
  button:hover:not(:disabled) { background-color: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3); }
  button:active:not(:disabled) { transform: translateY(0); }
  button:disabled { background-color: var(--gray); cursor: not-allowed; }
  button.secondary { background-color: var(--gray); margin-top: 10px; }
  button.secondary:hover:not(:disabled) { background-color: #7f8c8d; box-shadow: 0 5px 15px rgba(149, 165, 166, 0.3); }
  
  #resultado, #resultado-simulador { margin-top: 30px; padding: 20px; background-color: var(--light); border-radius: 8px; border-left: 4px solid var(--primary); display: none; animation: slideDown 0.5s ease-out; }
  @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

  .result-title { color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
  .result-item { margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
  .result-label { font-weight: 500; color: var(--label-text); }
  .result-value { font-weight: 600; color: var(--label-text); }
  
  .promedio-box, .puntaje-box, .corte-info { padding: 15px; border-radius: 8px; margin-top: 15px; text-align: center; transition: all 0.3s ease; }
  .promedio-box { background-color: var(--promedio-box-bg); color: var(--promedio-text-color); }
  .puntaje-box { background-color: var(--puntaje-box-bg); color: var(--box-text-color); font-size: 1.2rem; font-weight: 600; }
  .corte-info { background-color: var(--corte-box-bg); color: var(--corte-text-color); }
  #resultado-simulador .result-value { font-size: 1.5rem; }
  .diferencia { font-weight: 600; font-size: 1.2rem; }
  .diferencia.positiva { color: #27ae60; }
  .diferencia.negativa { color: #e74c3c; }

  .error-message { color: var(--danger); font-size: 0.9rem; margin-top: 5px; display: none; height: 1.2em; }
  .info-box { background-color: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; border-left: 4px solid var(--primary); }
  
  .spinner { display: none; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .main-tab-buttons { display: flex; border-bottom: 2px solid var(--border); margin-bottom: 25px; }
  .main-tab-button {
    flex: 1; padding: 15px; background: none; border: none; cursor: pointer;
    font-weight: 600; font-size: 1.1rem; color: var(--gray);
    border-bottom: 4px solid transparent; transition: all 0.3s ease;
    position: relative; top: 2px; margin: 0; width: auto;
  }
  .main-tab-button.active { color: var(--primary); border-bottom-color: var(--primary); }
  .main-tab-content { display: none; }
  .main-tab-content.active { display: block; animation: fadeIn 0.5s ease; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .ponderacion-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
  .score-input-group { display: flex; align-items: center; gap: 10px; }
  .score-input-group label { margin-bottom: 0; flex: 1; }
  .score-input-group input { flex: 0 0 120px; }
  .ponderacion-info { font-size: 0.8rem; color: var(--gray); text-align: right; margin-top: 4px; height: 1em; }
  
  /* Secciones de Información */
  .info-section { margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--border); }
  .info-section h2 { color: var(--primary); margin-bottom: 20px; text-align: center; }
  
  .useful-links-grid, .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
  .useful-link, .news-item { display: flex; flex-direction: column; padding: 15px; background-color: var(--light); border-radius: 8px; text-decoration: none; color: var(--text); transition: all 0.3s ease; }
  .useful-link:hover, .news-item:hover { background-color: var(--primary); color: white; transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  .useful-link svg { margin-left: auto; stroke: currentColor; }
  .news-item h3 { font-size: 1rem; margin-bottom: 5px; }
  .news-item p { font-size: 0.9rem; opacity: 0.8; }
  .news-item .date { font-size: 0.8rem; font-weight: 600; color: var(--primary); margin-bottom: 10px; }
  .news-item:hover .date { color: white; }

  /* Mejoras de UX/UI */
  #saved-simulations { margin-top: 30px; }
  .saved-sim-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
  .saved-sim-item { background-color: var(--saved-sim-bg); padding: 15px; border-radius: 8px; position: relative; border-left: 4px solid var(--primary); transition: transform 0.2s ease; }
  .saved-sim-item:hover { transform: translateY(-3px); }
  .saved-sim-item h4 { margin: 0 0 10px; font-size: 1rem; color: var(--primary); }
  .saved-sim-item p { font-size: 0.9rem; margin: 4px 0; display: flex; justify-content: space-between; }
  .delete-sim-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; color: var(--gray); font-size: 1.2rem; }
  .delete-sim-btn:hover { color: var(--danger); }
  .filters-group { display: flex; gap: 15px; margin-bottom: 20px; }

  .faq-item { border-bottom: 1px solid var(--border); margin-bottom: 10px; }
  .faq-question { width: 100%; background: none; border: none; text-align: left; font-weight: 500; font-size: 1rem; padding: 15px 0; cursor: pointer; display: flex; justify-content: space-between; align-items: center; color: var(--label-text); }
  .faq-question::after { content: '+'; font-size: 1.5rem; transition: transform 0.3s ease; }
  .faq-question.active::after { transform: rotate(45deg); }
  .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.4s ease; padding: 0 10px; }
  .faq-answer p { padding-bottom: 15px; }
  .faq-answer ul { margin-left: 20px; padding-bottom: 15px; }
  
  .about-section {
    text-align: center;
    margin-top: 40px;
    padding: 20px;
    background-color: var(--light);
    border-radius: 8px;
    font-style: italic;
    color: var(--gray);
  }

  .fade-in-section { opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
  .fade-in-section.is-visible { opacity: 1; transform: translateY(0); }
  
  #back-to-top-btn { position: fixed; bottom: 20px; right: 20px; background-color: var(--primary); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 24px; cursor: pointer; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s, transform 0.3s; z-index: 1000; }
  #back-to-top-btn.show { opacity: 1; visibility: visible; }
  #back-to-top-btn:hover { background-color: var(--primary-dark); transform: scale(1.1); }
  
  .warning-box { background-color: var(--warning-bg); border-left: 4px solid var(--warning); padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 0.9rem; }

  @media (max-width: 768px) {
    .filters-group { flex-direction: column; }
  }
  @media (max-width: 480px) {
    .container { margin: 15px; padding: 15px; }
    .input-group, .ponderacion-grid { flex-direction: column; gap: 15px; }
    .score-input-group { flex-wrap: wrap; }
    .score-input-group input { flex-grow: 1; }
    .isologo { max-width: 250px; }
    .theme-toggle-btn { top: 150px; }
  }
</style>
</head>
<body>

<div class="container">
  <button class="theme-toggle-btn" id="theme-toggle" aria-label="Cambiar tema">
    <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
    <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
  </button>

  <header>
    <img src="luci.svg" alt="Isologo Luci" class="isologo">
    <p class="subtitle">Calcula tu NEM y simula tu puntaje ponderado para la carrera de tus sueños</p>
  </header>

  <div class="main-tab-buttons">
    <button class="main-tab-button" data-tab="calculadora-nem" role="tab">Calculadora NEM</button>
    <button class="main-tab-button" data-tab="simulador-paes" role="tab">Simulador PAES</button>
  </div>

  <div class="main-tab-content" id="calculadora-nem" role="tabpanel">
    <div class="info-box">
      Esta calculadora te permite transformar tu promedio de notas de enseñanza media (NEM) al puntaje estándar utilizado en el proceso de admisión.
    </div>
    <div class="form-group">
      <label for="grupo">Grupo de dependencia</label>
      <select id="grupo" aria-describedby="grupo-error">
        <option value="">-- Selecciona tu grupo --</option>
        <option value="A">Grupo A - Enseñanza Media Humanístico-Científica</option>
        <option value="B">Grupo B - Enseñanza Media Humanístico-Científica de adultos</option>
        <option value="C">Grupo C - Enseñanza Media Técnico Profesional</option>
      </select>
      <a href="https://demre.cl/paes/factores-seleccion/tabla-transformacion-nem" target="_blank" class="help-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
        No sé cuál es mi grupo
      </a>
      <div id="grupo-error" class="error-message">Por favor, selecciona un grupo</div>
    </div>
    <div class="form-group">
      <label>Ingresa tus notas de enseñanza media</label>
      <div class="input-group">
        <div class="input-item"><label for="nem1">1° Medio</label><input type="text" id="nem1" placeholder="Ej: 5,8" inputmode="decimal" aria-describedby="nem1-error"><div id="nem1-error" class="error-message">Nota inválida (1.0 - 7.0)</div></div>
        <div class="input-item"><label for="nem2">2° Medio</label><input type="text" id="nem2" placeholder="Ej: 6,2" inputmode="decimal" aria-describedby="nem2-error"><div id="nem2-error" class="error-message">Nota inválida (1.0 - 7.0)</div></div>
      </div>
      <div class="input-group" style="margin-top:15px;">
        <div class="input-item"><label for="nem3">3° Medio</label><input type="text" id="nem3" placeholder="Ej: 6,5" inputmode="decimal" aria-describedby="nem3-error"><div id="nem3-error" class="error-message">Nota inválida (1.0 - 7.0)</div></div>
        <div class="input-item"><label for="nem4">4° Medio</label><input type="text" id="nem4" placeholder="Ej: 6,7" inputmode="decimal" aria-describedby="nem4-error"><div id="nem4-error" class="error-message">Nota inválida (1.0 - 7.0)</div></div>
      </div>
    </div>
    <button id="calcular-btn">
      <div class="spinner"></div>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
      Calcular Puntaje NEM
    </button>
    <button id="limpiar-btn" class="secondary">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
      Limpiar Formulario
    </button>
    <div id="resultado">
      <h3 class="result-title"><span>Resultados NEM</span></h3>
      <div class="promedio-box"><div class="result-item"><span>Promedio NEM:</span><span id="promedio-nem" class="result-value" style="font-size: 1.2rem;"></span></div></div>
      <div class="puntaje-box"><div class="result-item"><span>Puntaje NEM:</span><span id="puntaje-nem" class="result-value"></span></div></div>
    </div>
  </div>

  <div class="main-tab-content" id="simulador-paes" role="tabpanel">
    <div class="info-box">
      Selecciona una carrera, ingresa tus puntajes y descubre tu ponderación. Guarda simulaciones para comparar tus opciones.
    </div>
    <div class="filters-group">
      <div class="form-group input-item">
        <label for="area-conocimiento">Área de Conocimiento</label>
        <select id="area-conocimiento"><option value="">-- Todas las áreas --</option></select>
      </div>
      <div class="form-group input-item">
        <label for="region">Región</label>
        <select id="region"><option value="">-- Todas las regiones --</option></select>
      </div>
    </div>
    <div class="form-group">
      <label for="universidad">Universidad</label>
      <select id="universidad" disabled><option value="">-- Filtra para ver opciones --</option></select>
    </div>
    <div class="form-group">
      <label for="carrera">Carrera</label>
      <select id="carrera" disabled><option value="">-- Selecciona una universidad --</option></select>
    </div>
    <div id="disclaimer-box" class="warning-box" style="display: none;"></div>
    <div class="form-group">
      <label>Ingresa tus puntajes PAES (100 - 1000)</label>
      <div class="ponderacion-grid">
        <div class="input-item"><div class="score-input-group"><label for="p-nem">Puntaje NEM</label><input type="number" id="p-nem" placeholder="100-1000"></div><div class="ponderacion-info" id="w-nem"></div></div>
        <div class="input-item"><div class="score-input-group"><label for="p-ranking">Ranking</label><input type="number" id="p-ranking" placeholder="100-1000"></div><div class="ponderacion-info" id="w-ranking"></div></div>
        <div class="input-item"><div class="score-input-group"><label for="p-lectora">C. Lectora</label><input type="number" id="p-lectora" placeholder="100-1000"></div><div class="ponderacion-info" id="w-lectora"></div></div>
        <div class="input-item"><div class="score-input-group"><label for="p-m1">Matemática M1</label><input type="number" id="p-m1" placeholder="100-1000"></div><div class="ponderacion-info" id="w-m1"></div></div>
        <div class="input-item"><div class="score-input-group"><label for="p-m2">Matemática M2</label><input type="number" id="p-m2" placeholder="100-1000"></div><div class="ponderacion-info" id="w-m2"></div></div>
        <div class="input-item"><div class="score-input-group"><label for="p-ciencias">Ciencias</label><input type="number" id="p-ciencias" placeholder="100-1000"></div><div class="ponderacion-info" id="w-ciencias"></div></div>
        <div class="input-item"><div class="score-input-group"><label for="p-historia">Historia</label><input type="number" id="p-historia" placeholder="100-1000"></div><div class="ponderacion-info" id="w-historia"></div></div>
      </div>
    </div>
    <button id="simular-btn">
      <div class="spinner"></div>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20V16"></path></svg>
      Simular Puntaje
    </button>
    <div id="resultado-simulador">
        <h3 class="result-title">Resultado de la Simulación</h3>
        <div class="puntaje-box"><div class="result-item"><span>Tu Puntaje Ponderado:</span><span id="puntaje-ponderado" class="result-value"></span></div></div>
        <div class="corte-info">Puntaje de Corte Referencial 2025: <strong id="puntaje-corte"></strong></div>
        <div class="promedio-box"><div class="result-item"><span>Diferencia con el corte:</span><span id="diferencia-puntaje" class="diferencia"></span></div></div>
        <button id="guardar-sim-btn" class="secondary">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
          Guardar Simulación
        </button>
    </div>
    <div id="saved-simulations">
      <h3 class="result-title">Simulaciones Guardadas</h3>
      <div id="saved-sim-grid" class="saved-sim-grid"></div>
    </div>
  </div>

  <div class="info-section fade-in-section">
    <h2>Fechas Clave y Noticias</h2>
    <div class="news-grid">
      <a href="https://demre.cl/" target="_blank" class="news-item">
        <span class="date">AGOSTO 2025</span>
        <h3>Inscripción PAES de Verano</h3>
        <p>Proceso de inscripción para la Prueba de Acceso a la Educación Superior que se rinde a fin de año.</p>
      </a>
      <a href="https://demre.cl/" target="_blank" class="news-item">
        <span class="date">DICIEMBRE 2025</span>
        <h3>Rendición PAES de Verano</h3>
        <p>Fechas oficiales para la rendición de las pruebas obligatorias y electivas.</p>
      </a>
      <a href="https://demre.cl/" target="_blank" class="news-item">
        <span class="date">ENERO 2026</span>
        <h3>Resultados y Postulaciones</h3>
        <p>Entrega de resultados y apertura del proceso de postulación centralizada a las universidades.</p>
      </a>
    </div>
  </div>

  <div class="info-section fade-in-section">
    <h2>Preguntas Frecuentes</h2>
    <div class="faq-item">
      <button class="faq-question">¿Qué es el NEM?</button>
      <div class="faq-answer"><p>El NEM (Notas de Enseñanza Media) es el promedio de tus notas de 1° a 4° medio, transformado a un puntaje estándar (100 a 1000) que se usa en la admisión universitaria.</p></div>
    </div>
    <div class="faq-item">
        <button class="faq-question">¿Qué es la PAES y qué pruebas existen?</button>
        <div class="faq-answer">
            <p>La PAES (Prueba de Acceso a la Educación Superior) es el conjunto de pruebas que debes rendir para postular a la universidad. Se divide en:</p>
            <ul>
                <li><b>Pruebas Obligatorias:</b> Competencia Lectora y Competencia Matemática 1 (M1). Son requisito para todas las carreras.</li>
                <li><b>Pruebas Electivas:</b> Competencia Matemática 2 (M2), Ciencias, e Historia y Ciencias Sociales. Debes rendir al menos una, dependiendo de los requisitos de la carrera de tu interés.</li>
            </ul>
        </div>
    </div>
    <div class="faq-item">
        <button class="faq-question">¿Qué prueba electiva debo inscribir?</button>
        <div class="faq-answer"><p>Depende de la carrera a la que quieres postular. Carreras científicas y de la salud suelen exigir la prueba de Ciencias, mientras que carreras de humanidades y ciencias sociales piden la de Historia. Algunas ingenierías y carreras científicas exigen la M2. ¡Siempre revisa los requisitos de las carreras de tu interés en el sitio del DEMRE!</p></div>
    </div>
    <div class="faq-item">
        <button class="faq-question">¿Cómo funciona el puntaje ponderado?</button>
        <div class="faq-answer"><p>El puntaje ponderado es tu puntaje final de postulación para una carrera específica. Se calcula sumando los porcentajes de tus distintos puntajes (NEM, Ranking, PAES) según lo definido por cada universidad para esa carrera. Por ejemplo, una carrera puede darle 20% al NEM, 20% al Ranking, 30% a Lectora, etc.</p></div>
    </div>
    <div class="faq-item">
      <button class="faq-question">¿Qué grupo de dependencia debo seleccionar?</button>
      <div class="faq-answer"><p>Debes seleccionar según el tipo de establecimiento donde cursaste tu enseñanza media: Grupo A para científico-humanista, Grupo B para científico-humanista de adultos, y Grupo C para técnico-profesional.</p></div>
    </div>
  </div>

  <div class="info-section fade-in-section">
    <h2>Enlaces Útiles</h2>
    <div class="useful-links-grid">
      <a href="https://certificados.mineduc.cl/certificados-web/mvc/home/index?landingHome=estudios" target="_blank" class="useful-link">
        Obtiene tus notas aquí
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
      </a>
      <a href="https://demre.cl" target="_blank" class="useful-link">
        Sitio Oficial DEMRE
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
      </a>
    </div>
  </div>

  <div class="about-section fade-in-section">
    Página creada con ayuda de IAs, por Hugh - Renato y Cinthia.
  </div>
</div>

<button id="back-to-top-btn" title="Volver arriba">&uarr;</button>

<script>
document.addEventListener('DOMContentLoaded', async function() {
  // --- GLOBAL VARIABLES ---
  let tablasNEM = {};
  let carrerasData = [];
  let savedSimulations = JSON.parse(localStorage.getItem('savedSimulations')) || [];
  let lastCalculatedPuntajeNEM = null;

  // --- CORE FUNCTIONS ---
  async function fetchData() {
    try {
      const [carrerasResponse] = await Promise.all([
        fetch('carreras.json')
      ]);
      if (!carrerasResponse.ok) throw new Error('Error al cargar datos de carreras');
      
      carrerasData = await carrerasResponse.json();
      
      try {
          const nemResponse = await fetch('tabla_NEM_completa.json');
          if (nemResponse.ok) {
              tablasNEM = await nemResponse.json();
          }
      } catch (e) {
          console.warn("No se pudo cargar el archivo de NEM, la calculadora NEM no funcionará.");
      }

      return true;
    } catch (error) {
      console.error('Error cargando datos:', error);
      carrerasData = [];
      return false;
    }
  }

  const getEl = (id) => document.getElementById(id);
  const queryAll = (selector) => document.querySelectorAll(selector);

  function redondearNota(nota) { return Math.round(nota * 100) / 100; }

  // --- UI/UX FUNCTIONS ---
  function setupTheme() {
    const themeToggle = getEl('theme-toggle');
    const body = document.body;
    const sunIcon = getEl('theme-icon-sun');
    const moonIcon = getEl('theme-icon-moon');

    const applyTheme = (theme) => {
      body.classList.toggle('dark-mode', theme === 'dark');
      sunIcon.style.display = theme === 'dark' ? 'block' : 'none';
      moonIcon.style.display = theme === 'dark' ? 'none' : 'block';
    };

    themeToggle.addEventListener('click', () => {
      const newTheme = body.classList.contains('dark-mode') ? 'light' : 'dark';
      localStorage.setItem('theme', newTheme);
      applyTheme(newTheme);
    });

    const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    applyTheme(savedTheme);
  }

  function setupTabs() {
    const tabButtons = queryAll('.main-tab-button');
    const tabContents = queryAll('.main-tab-content');
    
    function activateTab(tabId) {
      tabButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tabId));
      tabContents.forEach(content => content.classList.toggle('active', content.id === tabId));
      localStorage.setItem('lastTab', tabId);

      if (tabId === 'simulador-paes' && lastCalculatedPuntajeNEM !== null) {
        const nemInput = getEl('p-nem');
        if (!nemInput.value) {
           nemInput.value = lastCalculatedPuntajeNEM;
           validateInput(nemInput.id, 100, 1000, true);
        }
      }
    }

    tabButtons.forEach(button => button.addEventListener('click', () => activateTab(button.dataset.tab)));
    
    const lastTab = localStorage.getItem('lastTab') || 'calculadora-nem';
    activateTab(lastTab);
  }

  function setupFaqs() {
    queryAll('.faq-question').forEach(q => {
      q.addEventListener('click', () => {
        const answer = q.nextElementSibling;
        q.classList.toggle('active');
        if (q.classList.contains('active')) {
          answer.style.maxHeight = answer.scrollHeight + "px";
          answer.style.padding = "0 10px 15px";
        } else {
          answer.style.maxHeight = null;
          answer.style.padding = "0 10px";
        }
      });
    });
  }

  function setupScrollFeatures() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('is-visible');
      });
    }, { threshold: 0.1 });
    queryAll('.fade-in-section').forEach(section => observer.observe(section));

    const backToTopBtn = getEl('back-to-top-btn');
    window.addEventListener('scroll', () => backToTopBtn.classList.toggle('show', window.scrollY > 300));
    backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
  }

  function validateInput(inputId, min, max, allowEmpty = false) {
    const input = getEl(inputId);
    const errorEl = getEl(inputId + '-error');
    const valueStr = input.value.replace(',', '.').trim();
    
    if (valueStr === '') {
      input.className = '';
      if(errorEl) errorEl.style.display = 'none';
      return allowEmpty ? 0 : null;
    }

    const valueNum = parseFloat(valueStr);
    if (isNaN(valueNum) || valueNum < min || valueNum > max) {
      input.className = 'invalid';
      if(errorEl) errorEl.style.display = 'block';
      return null;
    }
    
    input.className = 'valid';
    if(errorEl) errorEl.style.display = 'none';
    return valueNum;
  }

  // --- NEM CALCULATOR LOGIC ---
  function buscarPuntaje(grupo, nota) {
    const tabla = tablasNEM[grupo];
    if (!tabla) return 100;
    const notaRedondeada = redondearNota(nota);
    const notaStr = notaRedondeada.toFixed(2);
    if (tabla[notaStr] !== undefined) return tabla[notaStr];
    const claves = Object.keys(tabla).map(Number).sort((a, b) => a - b);
    for (let i = claves.length - 1; i >= 0; i--) {
      if (claves[i] <= notaRedondeada) return tabla[claves[i].toFixed(2)];
    }
    return 100;
  }

  function calcularNEM() {
    const btn = getEl('calcular-btn');
    const spinner = btn.querySelector('.spinner');
    spinner.style.display = 'inline-block';
    btn.disabled = true;

    setTimeout(() => {
      const grupoEl = getEl('grupo');
      const grupo = grupoEl.value;
      let valid = true;

      if (!grupo) {
        grupoEl.className = 'invalid';
        getEl('grupo-error').style.display = 'block';
        valid = false;
      } else {
        grupoEl.className = 'valid';
        getEl('grupo-error').style.display = 'none';
      }

      const notas = ['nem1', 'nem2', 'nem3', 'nem4'].map(id => validateInput(id, 1, 7));
      if (notas.some(n => n === null)) valid = false;
      
      if (!valid) {
        spinner.style.display = 'none';
        btn.disabled = false;
        return;
      }

      const promedio = redondearNota(notas.reduce((a, b) => a + b, 0) / 4);
      const puntaje = buscarPuntaje(grupo, promedio);

      lastCalculatedPuntajeNEM = puntaje;
      getEl('promedio-nem').textContent = promedio.toFixed(2).replace('.', ',');
      getEl('puntaje-nem').textContent = puntaje;
      
      const resultadoSection = getEl('resultado');
      resultadoSection.style.display = 'block';
      
      spinner.style.display = 'none';
      btn.disabled = false;
    }, 300);
  }

  function limpiarFormularioNEM() {
    ['grupo', 'nem1', 'nem2', 'nem3', 'nem4'].forEach(id => {
      const el = getEl(id);
      if(el.tagName === 'SELECT') el.selectedIndex = 0; else el.value = '';
      el.className = '';
      const errorEl = getEl(id + '-error');
      if (errorEl) errorEl.style.display = 'none';
    });
    getEl('resultado').style.display = 'none';
  }

  // --- PAES SIMULATOR LOGIC ---
  function populateFilters() {
    const areas = [...new Set(carrerasData.map(c => c.area).filter(Boolean))].sort();
    const regiones = [...new Set(carrerasData.map(c => c.region).filter(Boolean))].sort();
    
    const areaSelect = getEl('area-conocimiento');
    const regionSelect = getEl('region');
    
    areas.forEach(a => areaSelect.add(new Option(a, a)));
    regiones.forEach(r => regionSelect.add(new Option(r, r)));
  }

  function filterAndPopulateUniversities() {
      const selectedArea = getEl('area-conocimiento').value;
      const selectedRegion = getEl('region').value;
      const uniSelect = getEl('universidad');

      const filteredCarreras = carrerasData.filter(c => 
          (!selectedArea || c.area === selectedArea) && 
          (!selectedRegion || c.region === selectedRegion)
      );

      const universidades = [...new Set(filteredCarreras.map(c => c.universidad))].sort();
      
      uniSelect.innerHTML = '<option value="">-- Selecciona una universidad --</option>';
      universidades.forEach(uni => uniSelect.add(new Option(uni, uni)));
      uniSelect.disabled = universidades.length === 0;
      
      filterAndPopulateCarreras();
  }

  function filterAndPopulateCarreras() {
      const selectedUni = getEl('universidad').value;
      const selectedArea = getEl('area-conocimiento').value;
      const selectedRegion = getEl('region').value;
      const carreraSelect = getEl('carrera');

      carreraSelect.innerHTML = '<option value="">-- Selecciona una carrera --</option>';
      if (!selectedUni) {
          carreraSelect.disabled = true;
          return;
      }

      const carreras = carrerasData.filter(c =>
          c.universidad === selectedUni &&
          (!selectedArea || c.area === selectedArea) &&
          (!selectedRegion || c.region === selectedRegion)
      ).sort((a, b) => a.carrera.localeCompare(b.carrera));

      carreras.forEach(c => {
          const optionText = `${c.carrera}${c.sede ? ` (${c.sede})` : ''}`;
          // Usamos un ID único para la carrera en lugar del índice para evitar problemas al filtrar
          const uniqueId = `${c.universidad}-${c.carrera}-${c.sede || ''}`;
          carreraSelect.add(new Option(optionText, uniqueId));
      });
      carreraSelect.disabled = carreras.length === 0;
  }

  function displayPonderaciones(carrera) {
      const ponderaciones = carrera?.ponderaciones;
      const disclaimerBox = getEl('disclaimer-box');

      ['nem', 'ranking', 'lectora', 'm1', 'm2', 'ciencias', 'historia'].forEach(id => {
          const weightEl = getEl(`w-${id}`);
          const inputEl = getEl(`p-${id}`);
          let weight = 0;
          if (ponderaciones) {
            const key = id.charAt(0).toUpperCase() + id.slice(1).replace('m', 'M');
            weight = ponderaciones[key] || 0;
          }
          weightEl.textContent = weight > 0 ? `Pondera: ${weight}%` : '';
          inputEl.disabled = weight === 0;
          if (weight === 0) {
            inputEl.value = '';
            inputEl.className = '';
          }
      });

      const disclaimers = { /* ... tu lógica de disclaimers ... */ };
      const uniDisclaimers = disclaimers[carrera?.universidad] || [];
      if (uniDisclaimers.includes(carrera?.carrera)) {
        disclaimerBox.textContent = 'Importante: Esta carrera requiere una prueba especial, la cual completa esta ponderación.';
        disclaimerBox.style.display = 'block';
      } else {
        disclaimerBox.style.display = 'none';
      }
  }

  function simularPuntaje() {
    const btn = getEl('simular-btn');
    const spinner = btn.querySelector('.spinner');
    spinner.style.display = 'inline-block';
    btn.disabled = true;

    setTimeout(() => {
        const carreraId = getEl('carrera').value;
        if (!carreraId) {
            alert("Por favor, selecciona una carrera.");
            spinner.style.display = 'none';
            btn.disabled = false;
            return;
        }

        const carrera = carrerasData.find(c => `${c.universidad}-${c.carrera}-${c.sede || ''}` === carreraId);
        if(!carrera) {
            alert("Error: Carrera no encontrada.");
            spinner.style.display = 'none';
            btn.disabled = false;
            return;
        }

        const p = carrera.ponderaciones;
        const scores = {
            nem: validateInput('p-nem', 100, 1000, true) || 0,
            ranking: validateInput('p-ranking', 100, 1000, true) || 0,
            lectora: validateInput('p-lectora', 100, 1000, true) || 0,
            m1: validateInput('p-m1', 100, 1000, true) || 0,
            m2: validateInput('p-m2', 100, 1000, true) || 0,
            ciencias: validateInput('p-ciencias', 100, 1000, true) || 0,
            historia: validateInput('p-historia', 100, 1000, true) || 0
        };

        let puntajePonderado = (scores.nem * p.NEM + scores.ranking * p.Ranking + scores.lectora * p.Lectora + scores.m1 * p.M1 + scores.m2 * p.M2) / 100;
        
        let electivaScore = 0;
        if (p.Ciencias > 0 && p.Historia > 0) { // Si ambas electivas ponderan, se usa la mayor
             electivaScore = Math.max(scores.ciencias, scores.historia) * p.Ciencias;
        } else {
            if (p.Ciencias > 0) electivaScore += scores.ciencias * p.Ciencias;
            if (p.Historia > 0) electivaScore += scores.historia * p.Historia;
        }
        puntajePonderado += electivaScore / 100;

        const corte = carrera.corte_2025;
        const diferencia = puntajePonderado - corte;

        getEl('puntaje-ponderado').textContent = puntajePonderado.toFixed(2);
        getEl('puntaje-corte').textContent = corte.toFixed(2);
        const difEl = getEl('diferencia-puntaje');
        difEl.textContent = `${diferencia >= 0 ? '+' : ''}${diferencia.toFixed(2)}`;
        difEl.className = `diferencia ${diferencia >= 0 ? 'positiva' : 'negativa'}`;
        
        getEl('resultado-simulador').style.display = 'block';
        spinner.style.display = 'none';
        btn.disabled = false;
    }, 300);
  }

  function renderSavedSimulations() {
      const grid = getEl('saved-sim-grid');
      const container = getEl('saved-simulations');
      
      if(savedSimulations.length === 0) {
          container.style.display = 'none';
          return;
      }
      container.style.display = 'block';
      grid.innerHTML = '';
      
      savedSimulations.forEach((sim, index) => {
          const item = document.createElement('div');
          item.className = 'saved-sim-item';
          item.innerHTML = `
              <button class="delete-sim-btn" data-index="${index}" title="Eliminar">&times;</button>
              <h4>${sim.carreraNombre}</h4>
              <p><span>Ponderado:</span> <strong>${sim.ponderado}</strong></p>
              <p><span>Corte 2025:</span> <span>${sim.corte}</span></p>
              <p><span>Diferencia:</span> <strong class="diferencia ${sim.diferencia >= 0 ? 'positiva' : 'negativa'}">${sim.diferencia >= 0 ? '+' : ''}${sim.diferencia.toFixed(2)}</strong></p>
          `;
          grid.appendChild(item);
      });
  }

  function saveSimulation() {
      const carreraId = getEl('carrera').value;
      if (!carreraId) return;

      const carrera = carrerasData.find(c => `${c.universidad}-${c.carrera}-${c.sede || ''}` === carreraId);
      const ponderado = getEl('puntaje-ponderado').textContent;

      if(savedSimulations.length >= 6){
          alert("Puedes guardar un máximo de 6 simulaciones.");
          return;
      }

      savedSimulations.push({
          id: Date.now(),
          carreraNombre: `${carrera.carrera} (${carrera.universidad})`,
          ponderado: ponderado,
          corte: carrera.corte_2025,
          diferencia: parseFloat(ponderado) - carrera.corte_2025
      });
      localStorage.setItem('savedSimulations', JSON.stringify(savedSimulations));
      renderSavedSimulations();
  }

  // --- INITIALIZATION ---
  async function initialize() {
    setupTheme();
    setupTabs();
    setupFaqs();
    setupScrollFeatures();

    const dataLoaded = await fetchData();
    if (dataLoaded && carrerasData.length > 0) {
      populateFilters();
      filterAndPopulateUniversities();
    } else {
      getEl('universidad').innerHTML = '<option value="">Error al cargar datos</option>';
    }

    // --- EVENT LISTENERS ---
    getEl('calcular-btn').addEventListener('click', calcularNEM);
    getEl('limpiar-btn').addEventListener('click', limpiarFormularioNEM);

    getEl('simular-btn').addEventListener('click', simularPuntaje);
    getEl('guardar-sim-btn').addEventListener('click', saveSimulation);
    
    getEl('area-conocimiento').addEventListener('change', filterAndPopulateUniversities);
    getEl('region').addEventListener('change', filterAndPopulateUniversities);
    getEl('universidad').addEventListener('change', filterAndPopulateCarreras);
    getEl('carrera').addEventListener('change', () => {
        const carreraId = getEl('carrera').value;
        const carrera = carrerasData.find(c => `${c.universidad}-${c.carrera}-${c.sede || ''}` === carreraId);
        displayPonderaciones(carrera);
    });

    getEl('saved-sim-grid').addEventListener('click', (e) => {
      if (e.target.classList.contains('delete-sim-btn')) {
        const index = parseInt(e.target.dataset.index, 10);
        savedSimulations.splice(index, 1);
        localStorage.setItem('savedSimulations', JSON.stringify(savedSimulations));
        renderSavedSimulations();
      }
    });

    queryAll('#calculadora-nem input, #calculadora-nem select').forEach(input => {
      input.addEventListener('input', () => {
        if(input.id === 'grupo') {
          if (input.value) {
            input.classList.add('valid');
            input.classList.remove('invalid');
            getEl('grupo-error').style.display = 'none';
          }
        } else {
          validateInput(input.id, 1, 7);
        }
      });
    });

    ['p-nem', 'p-ranking', 'p-lectora', 'p-m1', 'p-m2', 'p-ciencias', 'p-historia'].forEach(id => {
        getEl(id).addEventListener('input', () => validateInput(id, 100, 1000, true));
    });

    renderSavedSimulations();
  }

  initialize();
});
</script>

</body>
</html>
